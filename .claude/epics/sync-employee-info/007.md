---
name: Documentation - API docs, deployment guide, and E2E test plan
status: open
created: 2026-01-09T02:15:19Z
updated: 2026-01-09T02:15:19Z
github: [Will be updated when synced to GitHub]
depends_on: [004, 005, 006]
parallel: false
conflicts_with: []
---

# Task: Documentation - API docs, deployment guide, and E2E test plan

## Description

Create comprehensive documentation for the employee sync feature including API usage guide, deployment procedures, and end-to-end test plan. Documentation should be clear, actionable, and maintainable.

**Documents to Create:**
1. API Usage Guide - How to use employee endpoints
2. Deployment Guide - Staging and production deployment
3. E2E Test Plan - Manual testing scenarios

## Acceptance Criteria

### API Documentation
- [ ] `backend/docs/employee-api-guide.md` created
- [ ] Covers all 6 endpoints with examples
- [ ] Request/response formats documented
- [ ] Authentication requirements explained
- [ ] Error codes documented (401, 403, 404, 422, 500)
- [ ] cURL and Python examples provided
- [ ] Postman collection exported (optional)

### Deployment Guide
- [ ] `backend/docs/employee-deployment.md` created
- [ ] Pre-deployment checklist
- [ ] Database migration steps
- [ ] Environment variables documented:
  - FHS_HRS_BASE_URL
  - FHS_COVID_API_BASE_URL
- [ ] Staging deployment procedure
- [ ] Production deployment procedure
- [ ] Rollback plan
- [ ] Health check verification

### E2E Test Plan
- [ ] `backend/docs/employee-e2e-tests.md` created
- [ ] Manual test scenarios (10+ scenarios)
- [ ] Test data preparation
- [ ] Expected results for each scenario
- [ ] Edge cases covered
- [ ] Error scenario testing
- [ ] Performance testing (bulk sync 100+ employees)

## Technical Details

### API Usage Guide Structure

```markdown
# Employee API Usage Guide

## Overview
Employee sync and management system with 6 REST API endpoints.

## Authentication
All endpoints require admin role. Include JWT token in Authorization header:
```
Authorization: Bearer {admin_jwt_token}
```

## Endpoints

### 1. Sync Single Employee

**POST /api/employees/sync**

Sync single employee from HRS or COVID API.

**Request:**
```json
{
  "emp_id": 6204,
  "source": "hrs",
  "token": null
}
```

**Response:**
```json
{
  "id": "VNW0006204",
  "name_tw": "陳玉俊",
  "name_en": "PHAN ANH TUẤN",
  "department_code": "7410",
  ...
}
```

**cURL Example:**
```bash
curl -X POST "http://localhost:8000/api/employees/sync" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "emp_id": 6204,
    "source": "hrs"
  }'
```

**Python Example:**
```python
import httpx

async with httpx.AsyncClient() as client:
    response = await client.post(
        "http://localhost:8000/api/employees/sync",
        json={"emp_id": 6204, "source": "hrs"},
        headers={"Authorization": f"Bearer {token}"}
    )
    employee = response.json()
```

### 2. Bulk Sync Employees

**POST /api/employees/bulk-sync**

Sync multiple employees (from_id to to_id).

**Request:**
```json
{
  "from_id": 6200,
  "to_id": 6210,
  "source": "hrs",
  "token": null
}
```

**Response:**
```json
{
  "total": 11,
  "success": 9,
  "failed": 1,
  "skipped": 1,
  "errors": [
    {"emp_id": 6207, "error": "API timeout"}
  ]
}
```

### 3-6. Other Endpoints
[Document remaining endpoints similarly]

## Error Handling

| Code | Meaning | Action |
|------|---------|--------|
| 401 | Unauthorized | Check JWT token validity |
| 403 | Forbidden | Admin role required |
| 404 | Not Found | Employee ID doesn't exist |
| 422 | Validation Error | Check request body format |
| 500 | Internal Error | Check server logs |
| 503 | Service Unavailable | External API down |
```

### Deployment Guide Structure

```markdown
# Employee Feature Deployment Guide

## Pre-Deployment Checklist

- [ ] All tests passing (unit + integration)
- [ ] Code reviewed and approved
- [ ] Database backup created
- [ ] Environment variables configured
- [ ] Access to FHS APIs verified

## Environment Variables

Add to `.env`:
```
FHS_HRS_BASE_URL=https://www.fhs.com.tw/ads/api/Furnace/rest/json/hr
FHS_COVID_API_BASE_URL=https://www.fhs.com.tw/fhs_covid_api/api/reportVaccines/detail
```

## Staging Deployment

### Step 1: Backup Database
```bash
pg_dump -h staging-db-host -U user -d dbname > backup_staging_$(date +%Y%m%d_%H%M%S).sql
```

### Step 2: Deploy Code
```bash
git pull origin main
pip install -r requirements.txt
```

### Step 3: Run Migration
```bash
alembic upgrade head
alembic current  # Verify
psql -c "\\d employees"  # Verify table
```

### Step 4: Restart Service
```bash
sudo systemctl restart backend-api
sudo systemctl status backend-api
```

### Step 5: Health Check
```bash
curl http://staging-api/health

# Test sync endpoint
curl -X POST "http://staging-api/api/employees/sync" \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -d '{"emp_id": 6204, "source": "hrs"}'
```

## Production Deployment

[Similar structure with more caution]

## Rollback Plan

If issues detected:
```bash
# Rollback code
git checkout {previous-commit}
sudo systemctl restart backend-api

# Rollback migration
alembic downgrade -1

# Restore database (last resort)
psql -U user -d dbname < backup_prod_TIMESTAMP.sql
```
```

### E2E Test Plan Structure

```markdown
# Employee E2E Test Plan

## Test Environment
- Staging API: https://staging-api.example.com
- Admin JWT Token: [Provide test token]
- Test Employee IDs: 6200-6210

## Test Scenarios

### Scenario 1: Sync Single Employee from HRS

**Objective:** Verify single employee sync from HRS API

**Steps:**
1. Call POST /api/employees/sync
   - emp_id: 6204
   - source: "hrs"
2. Verify response status: 200 OK
3. Verify response contains employee data
4. Verify employee stored in database

**Expected Results:**
- Response includes: id, name_tw, name_en, department, etc.
- Database query returns employee: `SELECT * FROM employees WHERE id='VNW0006204'`

**SQL Verification:**
```sql
SELECT id, name_tw, name_en, department_code FROM employees WHERE id='VNW0006204';
```

### Scenario 2: Bulk Sync 100 Employees

**Objective:** Verify bulk sync performance and error handling

**Steps:**
1. Call POST /api/employees/bulk-sync
   - from_id: 6200
   - to_id: 6299
   - source: "hrs"
2. Monitor response time (should < 150 seconds)
3. Verify summary: total=100, success+failed+skipped=100

**Expected Results:**
- Success rate > 80%
- Errors array contains details for failed IDs
- Database has synced employees

### Scenario 3-10: [Additional scenarios]
- Sync from COVID API with token
- Search employees by name
- Search employees by department
- Update employee information
- Delete employee
- Error handling: invalid token
- Error handling: employee not found
- Error handling: validation errors

## Performance Tests

### Bulk Sync Performance
- Sync 100 employees: < 150 seconds
- Sync 500 employees: < 12 minutes

### Search Performance
- Search 1000 employees: < 500ms
- Search with filters: < 500ms
```

## Dependencies

- [x] Task 004: API endpoints implemented
- [x] Task 005: Tests completed
- [x] Task 006: Integration tests completed

## Effort Estimate

- **Size:** M (Medium)
- **Hours:** 6-8 hours
  - 2h: API usage guide
  - 2h: Deployment guide
  - 2h: E2E test plan
  - 1h: Review and polish
  - 1h: Screenshots/diagrams (optional)
- **Parallel:** false (depends on implementation being complete)

## Definition of Done

- [ ] All 3 documents created
- [ ] API guide has examples for all 6 endpoints
- [ ] Deployment guide has step-by-step instructions
- [ ] E2E test plan has 10+ test scenarios
- [ ] Documents reviewed for clarity
- [ ] Code examples tested and verified
- [ ] Markdown formatting correct
- [ ] Links between documents added
- [ ] Documents added to main README (optional)
