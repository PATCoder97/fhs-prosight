---
name: Register router in main.py and configure environment
status: open
created: 2026-01-12T07:14:18Z
updated: 2026-01-12T07:24:05Z
github: https://github.com/PATCoder97/fhs-prosight/issues/59
depends_on: [58]
parallel: false
conflicts_with: [58]
---

# Task: Register router in main.py and configure environment

## Description
Register the PIDMS router in the main FastAPI application and configure environment variables for PIDKey.com API access. Update configuration settings to include PIDKEY_API_KEY and PIDKEY_BASE_URL.

## Acceptance Criteria
- [ ] PIDMS router registered in `backend/app/main.py`
- [ ] Environment variables added to `.env` file
- [ ] Settings updated in `backend/app/core/config.py`
- [ ] Environment variable validation on startup
- [ ] Clear error message if PIDKEY_API_KEY is missing
- [ ] Server starts successfully with new router

## Technical Details

**File 1:** `backend/app/main.py`
```python
# Add import
from app.routers import pidms

# Register router (add after existing routers)
app.include_router(pidms.router)
```

**File 2:** `.env` (add these variables)
```bash
# PIDKey.com API Configuration
PIDKEY_API_KEY=nVHBz3RIsHpXHofLv3B89iFK8
PIDKEY_BASE_URL=https://pidkey.com/ajax/pidms_api
```

**File 3:** `backend/app/core/config.py`
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # ... existing settings ...

    # PIDKey.com API
    PIDKEY_API_KEY: str
    PIDKEY_BASE_URL: str = "https://pidkey.com/ajax/pidms_api"

    class Config:
        env_file = ".env"
        case_sensitive = True

    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        # Validate critical settings
        if not self.PIDKEY_API_KEY:
            raise ValueError("PIDKEY_API_KEY environment variable is required")
```

**Startup Validation:**
Test that server fails gracefully if API key is missing:
```bash
# Remove PIDKEY_API_KEY from .env temporarily
# Start server - should see clear error message
# Restore PIDKEY_API_KEY
# Start server - should succeed
```

**Files Affected:**
- `backend/app/main.py` (update)
- `.env` (update)
- `backend/app/core/config.py` (update)

## Dependencies
- [x] Task 005: Router must exist before registration

## Effort Estimate
- Size: XS
- Hours: 1 hour
- Parallel: false (depends on task 005, conflicts with 005)

## Definition of Done
- [x] Router registered and accessible
- [x] Environment variables configured
- [x] Settings validation working
- [x] Server starts without errors
- [x] API key validation tested
- [x] All PIDMS endpoints accessible at /api/pidms/*
