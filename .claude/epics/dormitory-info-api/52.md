---
name: Register router and run database migration
status: open
created: 2026-01-12T03:16:26Z
updated: 2026-01-12T03:25:14Z
github: https://github.com/PATCoder97/fhs-prosight/issues/52
depends_on: [46, 50, 51]
parallel: false
conflicts_with: []
---

# Task: Register Router and Run Database Migration

## Description

Complete the integration by registering the dormitory_bills router in the main FastAPI application and running the Alembic migration to create the dormitory_bills table in the database.

## Acceptance Criteria

- [ ] Dormitory bills router imported in `backend/app/main.py`
- [ ] Router registered with correct prefix and tags
- [ ] Database migration executed with `alembic upgrade head`
- [ ] Verify table created with all constraints and indexes
- [ ] API documentation accessible at /docs showing new endpoints
- [ ] Both endpoints visible: POST /api/dormitory-bills/import, GET /api/dormitory-bills/search
- [ ] OpenAPI schema includes dormitory-bills tag

## Technical Details

**Router Registration** (`backend/app/main.py`):

Add import:
```python
from app.routers import auth, users, employees, hrs_data, evaluations, dormitory_bills
```

Register router:
```python
# Register routers
app.include_router(auth.router, prefix="/api")
app.include_router(users.router, prefix="/api")
app.include_router(employees.router, prefix="/api")
app.include_router(hrs_data.router, prefix="/api")
app.include_router(evaluations.router, prefix="/api")
app.include_router(dormitory_bills.router, prefix="/api")
```

**Run Migration:**
```bash
cd backend
alembic upgrade head
```

**Verify Migration:**
```sql
-- Check table exists
SELECT table_name FROM information_schema.tables WHERE table_name = 'dormitory_bills';

-- Check constraints
SELECT constraint_name, constraint_type FROM information_schema.table_constraints WHERE table_name = 'dormitory_bills';

-- Check indexes
SELECT indexname FROM pg_indexes WHERE tablename = 'dormitory_bills';
```

**Verification Steps:**
1. Start server: `uvicorn app.main:app --reload`
2. Check /docs endpoint for new routes
3. Verify both endpoints listed under "dormitory-bills" tag
4. Test import endpoint (admin user required)
5. Test search endpoint (authenticated user required)

## Dependencies

- [ ] Task 46 completed (migration file exists)
- [ ] Task 50 completed (import endpoint exists)
- [ ] Task 51 completed (search endpoint exists)
- [ ] Database connection configured
- [ ] FastAPI app configured

## Effort Estimate

- Size: XS
- Hours: 0.5
- Parallel: false (depends on Tasks 46, 50, 51)

## Definition of Done

- [ ] Dormitory bills router imported in main.py
- [ ] Router registered with correct prefix ("/api")
- [ ] Migration executed successfully
- [ ] Table created with all constraints (unique, check, FK)
- [ ] All indexes created (employee_id, term_code, dorm_code, total_amount, sort)
- [ ] Server starts without errors
- [ ] /docs shows both endpoints under "dormitory-bills" tag
- [ ] POST /api/dormitory-bills/import visible in OpenAPI docs
- [ ] GET /api/dormitory-bills/search visible in OpenAPI docs
- [ ] Can access endpoints via /api/dormitory-bills prefix
- [ ] Committed with message: "Issue #XX: Register dormitory bills router and run migration"
