---
name: Create REST API endpoints for achievement queries
status: completed
created: 2026-01-10T01:12:36Z
updated: 2026-01-10T06:13:45Z
github: https://github.com/PATCoder97/fhs-prosight/issues/30
depends_on: [27, 28, 29]
parallel: false
conflicts_with: []
---

# Task: Create REST API Endpoints for Achievement Queries

## Description

Add 2 new endpoints to the existing `backend/app/routers/hrs_data.py` router to expose achievement/evaluation data. These endpoints follow the exact same patterns as the salary endpoints in the same file.

Total new code: ~60 lines (both endpoints with OpenAPI documentation).

## Acceptance Criteria

- [ ] Endpoint 1: `GET /api/hrs-data/achievements` - View own achievements
- [ ] Endpoint 2: `GET /api/hrs-data/achievements/{employee_id}` - View any employee's achievements
- [ ] Both endpoints use `AchievementResponse` as response model
- [ ] Authorization: Endpoint 1 uses `get_current_user`, Endpoint 2 uses `require_authenticated_user`
- [ ] OpenAPI documentation with summary, description, examples
- [ ] Error handling: 400, 401, 403, 404, 503
- [ ] Logging for all requests
- [ ] Router docstring updated to list all 6 endpoints

## Technical Details

**File to modify**: `backend/app/routers/hrs_data.py`

**Update Router Docstring** (at top of file):
```python
"""
HRS Data API Router.

Provides 6 endpoints:
1. GET /salary - View own salary (authenticated users)
2. GET /salary/history - View salary history with trend (authenticated users)
3. GET /salary/history/{employee_id} - View any employee's salary history (authenticated users)
4. GET /salary/{employee_id} - View any employee's salary (authenticated users)
5. GET /achievements - View own achievements (authenticated users)
6. GET /achievements/{employee_id} - View any employee's achievements (authenticated users)
"""
```

**Add to imports**:
```python
from app.schemas.hrs_data import SalaryResponse, SalaryHistoryResponse, AchievementResponse
```

**Endpoint 1: Get Own Achievements**:
```python
@router.get(
    "/achievements",
    response_model=AchievementResponse,
    summary="Get own achievements",
    description="Get current user's achievement/evaluation history across all years"
)
async def get_own_achievements(
    current_user: dict = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """
    Get current user's achievement/evaluation history.

    **Access:** Authenticated users (any role)

    **Response:**
    - 200: Achievement data returned
    - 404: No achievement data found
    - 503: HRS API unavailable

    **Example:**
    ```
    GET /api/hrs-data/achievements
    ```
    """
    emp_id = current_user["localId"]
    logger.info(f"User {emp_id} querying own achievements")

    try:
        achievements = await hrs_data_service.get_employee_achievements(db, emp_id)
        return achievements
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Unexpected error getting achievements: {e}", exc_info=True)
        raise HTTPException(
            status_code=503,
            detail="Failed to retrieve achievement data. Please try again later."
        )
```

**Endpoint 2: Get Employee Achievements**:
```python
@router.get(
    "/achievements/{employee_id}",
    response_model=AchievementResponse,
    summary="Get employee achievements",
    description="Get any employee's achievement/evaluation history"
)
async def get_employee_achievements(
    employee_id: str,
    current_user: dict = Depends(require_authenticated_user),
    db: AsyncSession = Depends(get_db)
):
    """
    Get any employee's achievement/evaluation history.

    **Access:** Authenticated users (excludes guest)

    **Path Parameters:**
    - employee_id: Employee ID (e.g., VNW0006204)

    **Response:**
    - 200: Achievement data returned
    - 400: Invalid employee ID format
    - 403: Forbidden (guest user)
    - 404: No achievement data found
    - 503: HRS API unavailable

    **Example:**
    ```
    GET /api/hrs-data/achievements/VNW0006204
    ```
    """
    logger.info(
        f"User {current_user['localId']} querying achievements for {employee_id}"
    )

    try:
        achievements = await hrs_data_service.get_employee_achievements(db, employee_id)
        return achievements
    except HTTPException:
        raise
    except Exception as e:
        logger.error(
            f"Unexpected error getting employee {employee_id} achievements: {e}",
            exc_info=True
        )
        raise HTTPException(
            status_code=503,
            detail="Failed to retrieve achievement data. Please try again later."
        )
```

**Location**: Add after the last salary endpoint, before the end of file

**Pattern to follow**: Mirror the structure of salary endpoints in the same file

## Dependencies

- [ ] Task 001 completed (AchievementResponse schema exists)
- [ ] Task 002 completed (HRS client method exists)
- [ ] Task 003 completed (service method exists)
- [ ] Authorization functions exist (from existing codebase)

## Effort Estimate

- Size: S
- Hours: 2 hours
- Parallel: false (depends on 001, 002, 003)

## Definition of Done

- [ ] Code implemented in hrs_data.py
- [ ] Both endpoints added and working
- [ ] Router docstring updated
- [ ] Import statement updated with AchievementResponse
- [ ] Authorization working (blocks guests, allows authenticated)
- [ ] Error handling for all cases
- [ ] OpenAPI documentation auto-generated
- [ ] Logging messages added
- [ ] Committed with message: "Issue #XX: Create REST API endpoints for achievement queries"
- [ ] No breaking changes to existing salary endpoints
