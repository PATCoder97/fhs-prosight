---
name: Create database model and migration for evaluations table
status: completed
created: 2026-01-10T09:10:21Z
updated: 2026-01-10T09:31:25Z
github: https://github.com/PATCoder97/fhs-prosight/issues/38
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Create Database Model and Migration for Evaluations Table

## Description

Create the SQLAlchemy model for the `evaluations` table with 30+ fields tracking employee evaluation data across multiple review levels (department and management office). Generate and run Alembic migration to create the table with proper constraints and indexes.

## Acceptance Criteria

- [ ] SQLAlchemy model created at `backend/app/models/evaluation.py` with all 30+ fields
- [ ] Unique constraint added on (term_code, employee_id)
- [ ] Indexes created on term_code, employee_id, and dept_code
- [ ] Timestamps (created_at, updated_at) configured with auto-update
- [ ] Alembic migration generated with `alembic revision -m "Add evaluations table"`
- [ ] Migration includes table creation with all columns
- [ ] Migration includes unique constraint and indexes
- [ ] Migration successfully applied with `alembic upgrade head`
- [ ] Database table verified with correct schema

## Technical Details

**Model Structure** (`backend/app/models/evaluation.py`):
- **Primary Key**: `id` (Integer, auto-increment)
- **Composite Unique Key**: `term_code` + `employee_id`
- **Required Fields**: term_code (String 10), employee_id (String 20)
- **Employee Info Fields** (all nullable): employee_name, job_level, nation, dept_code, dept_name, grade_code, grade_name
- **Dept Evaluation Fields** (9 fields): init_score, init_comment, init_reviewer, review_score, review_comment, review_reviewer, final_score, final_comment, final_reviewer
- **Mgr Evaluation Fields** (9 fields): mgr_init_score, mgr_init_comment, mgr_init_reviewer, mgr_review_score, mgr_review_comment, mgr_review_reviewer, mgr_final_score, mgr_final_comment, mgr_final_reviewer
- **Additional**: leave_days (Float, nullable)
- **Timestamps**: created_at, updated_at (auto-managed)

**Constraints**:
```python
UniqueConstraint('term_code', 'employee_id', name='uq_evaluations_term_employee')
```

**Indexes**:
```python
Index('ix_evaluations_term_code', 'term_code')
Index('ix_evaluations_employee_id', 'employee_id')
Index('ix_evaluations_dept_code', 'dept_code')
```

**Migration File**: `backend/alembic/versions/xxx_add_evaluations_table.py`
- Use `op.create_table()` with all columns
- Add constraint with `op.create_unique_constraint()`
- Add indexes with `op.create_index()`

## Dependencies

- [ ] SQLAlchemy installed (existing)
- [ ] Alembic configured (existing)
- [ ] Database connection available (existing)

## Effort Estimate

- Size: M
- Hours: 2
- Parallel: false (blocks all other tasks - need model before schemas/services)

## Definition of Done

- [ ] Model file created with all fields properly typed
- [ ] Unique constraint on (term_code, employee_id) prevents duplicates
- [ ] Indexes created for search performance
- [ ] Migration file generated and committed
- [ ] Migration applied to database (table exists)
- [ ] Can query table with `SELECT * FROM evaluations LIMIT 1` (returns empty or data)
- [ ] Committed with message: "Issue #XX: Add evaluations table model and migration"
