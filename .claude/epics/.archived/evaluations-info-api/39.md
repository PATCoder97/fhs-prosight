---
name: Create Pydantic schemas for evaluation API
status: completed
created: 2026-01-10T09:10:21Z
updated: 2026-01-10T09:36:40Z
github: https://github.com/PATCoder97/fhs-prosight/issues/39
depends_on: [38]
parallel: false
conflicts_with: []
---

# Task: Create Pydantic Schemas for Evaluation API

## Description

Create Pydantic schema models for evaluation API request/response handling. Implement nested structure with reusable components for evaluation levels (init/review/final) and groups (dept/mgr).

## Acceptance Criteria

- [ ] Schema file created at `backend/app/schemas/evaluation.py`
- [ ] `EvaluationLevel` model created (score, comment, reviewer)
- [ ] `EvaluationGroup` model created (init, review, final)
- [ ] `EvaluationResponse` model created with nested dept_evaluation and mgr_evaluation
- [ ] `SearchResponse` model created with pagination fields (total, page, page_size, results)
- [ ] `UploadSummary` model created (success, summary dict, error_details list)
- [ ] All Optional fields properly typed
- [ ] Example data added to Config classes
- [ ] Field descriptions added for OpenAPI documentation

## Technical Details

**Schema Models** (`backend/app/schemas/evaluation.py`):

1. **EvaluationLevel** (reusable component):
```python
class EvaluationLevel(BaseModel):
    """Single evaluation level (init/review/final)."""
    score: Optional[str] = Field(None, description="評核成績 (甲/優/etc.)")
    comment: Optional[str] = Field(None, description="評語")
    reviewer: Optional[str] = Field(None, description="主管工號")
```

2. **EvaluationGroup** (reusable component):
```python
class EvaluationGroup(BaseModel):
    """Evaluation group (dept or mgr)."""
    init: EvaluationLevel = Field(..., description="初核")
    review: EvaluationLevel = Field(..., description="複核")
    final: EvaluationLevel = Field(..., description="核定")
```

3. **EvaluationResponse** (main response):
```python
class EvaluationResponse(BaseModel):
    """Response model for evaluation record."""
    id: int
    term_code: str
    employee_id: str
    employee_name: Optional[str]
    job_level: Optional[str]
    nation: Optional[str]
    dept_code: Optional[str]
    dept_name: Optional[str]
    grade_code: Optional[str]
    grade_name: Optional[str]
    dept_evaluation: EvaluationGroup
    mgr_evaluation: EvaluationGroup
    leave_days: Optional[float]
    created_at: datetime
    updated_at: datetime
```

4. **SearchResponse** (paginated):
```python
class SearchResponse(BaseModel):
    """Paginated search response."""
    total: int = Field(..., description="Total matching records")
    page: int = Field(..., description="Current page number")
    page_size: int = Field(..., description="Items per page")
    results: List[EvaluationResponse] = Field(..., description="Evaluation records")
```

5. **UploadSummary** (upload result):
```python
class UploadSummary(BaseModel):
    """Upload result summary."""
    success: bool = Field(..., description="Whether upload succeeded")
    summary: dict = Field(..., description="Counts: total_rows, created, updated, errors")
    error_details: List[dict] = Field(default_factory=list, description="Error details per row")
```

## Dependencies

- [ ] Task 001 completed (model exists for reference)
- [ ] Pydantic library available (existing)
- [ ] FastAPI available (existing)

## Effort Estimate

- Size: S
- Hours: 1
- Parallel: false (depends on Task 001 completion)

## Definition of Done

- [ ] All 5 schema classes created
- [ ] Nested structure correctly represents dept/mgr evaluation groups
- [ ] All fields properly typed (Optional where nullable)
- [ ] Example data provided for API documentation
- [ ] File imports correctly (no syntax errors)
- [ ] Schemas match database model structure from Task 001
- [ ] Committed with message: "Issue #XX: Add Pydantic schemas for evaluations API"
