---
name: Create Pydantic schemas for salary data responses
status: completed
created: 2026-01-09T09:59:30Z
updated: 2026-01-09T10:31:06Z
github: https://github.com/PATCoder97/fhs-prosight/issues/20
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Create Pydantic schemas for salary data responses

## Description

Create comprehensive Pydantic schemas to structure salary data responses. Transform flat 45-field HRS response into organized 3-tier structure (summary + income + deductions). Define schemas for single month queries, multi-month history, and trend analysis.

**Key Deliverable:** `backend/app/schemas/hrs_data.py` with 9 Pydantic schemas

## Acceptance Criteria

- [ ] File `backend/app/schemas/hrs_data.py` created
- [ ] `SalarySummary` schema: tong_tien_cong, tong_tien_tru, thuc_linh (3 fields)
- [ ] `SalaryIncome` schema: 32 income fields (luong_co_ban, thuong, phu_cap, overtime, etc.)
- [ ] `SalaryDeductions` schema: 10 deduction fields (bhxh, bhyt, bhtn, taxes, fees, etc.)
- [ ] `SalaryPeriod` schema: year, month
- [ ] `SalaryResponse` schema: employee_id, employee_name, period, summary, income, deductions
- [ ] `MonthlySalary` schema: month, summary, income, deductions
- [ ] `SalaryChange` schema: from_month, to_month, field, change, percentage, direction
- [ ] `SalaryTrend` schema: average_income, average_deductions, average_net, highest, lowest, changes
- [ ] `SalaryHistoryResponse` schema: employee_id, employee_name, period, months[], trend
- [ ] All schemas inherit from Pydantic BaseModel
- [ ] Field descriptions added with Field() for documentation
- [ ] Numeric fields use proper types (int, float, Decimal)
- [ ] Optional fields properly marked (e.g., employee_name can be None)

## Technical Details

### Schema Structure

**1. SalarySummary**
```python
class SalarySummary(BaseModel):
    tong_tien_cong: float = Field(..., description="Tổng tiền cộng (total income)")
    tong_tien_tru: float = Field(..., description="Tổng tiền trừ (total deductions)")
    thuc_linh: float = Field(..., description="Thực lĩnh (net salary)")
```

**2. SalaryIncome (32 fields)**
```python
class SalaryIncome(BaseModel):
    luong_co_ban: float = Field(0.0, description="Basic salary")
    thuong_nang_suat: float = Field(0.0, description="Performance bonus")
    phu_cap_chuc_vu: float = Field(0.0, description="Position allowance")
    phu_cap_trach_nhiem: float = Field(0.0, description="Responsibility allowance")
    # ... 28 more income fields
    # Map to HRS API field indices: fields[44], fields[2], etc.
```

**3. SalaryDeductions (10 fields)**
```python
class SalaryDeductions(BaseModel):
    bhxh: float = Field(0.0, description="Social insurance")
    bhyt: float = Field(0.0, description="Health insurance")
    bhtn: float = Field(0.0, description="Unemployment insurance")
    thue_tncn: float = Field(0.0, description="Personal income tax")
    # ... 6 more deduction fields
    # Map to HRS API field indices: fields[33], fields[34], etc.
```

**4. SalaryPeriod**
```python
class SalaryPeriod(BaseModel):
    year: int
    month: int
```

**5. SalaryResponse (Main Response)**
```python
class SalaryResponse(BaseModel):
    employee_id: str = Field(..., description="Employee ID (e.g., VNW0006204)")
    employee_name: Optional[str] = Field(None, description="Employee name")
    period: SalaryPeriod
    summary: SalarySummary
    income: SalaryIncome
    deductions: SalaryDeductions
```

**6. MonthlySalary**
```python
class MonthlySalary(BaseModel):
    month: int
    summary: SalarySummary
    income: SalaryIncome
    deductions: SalaryDeductions
```

**7. SalaryChange**
```python
class SalaryChange(BaseModel):
    from_month: int
    to_month: int
    field: str = Field(..., description="Field that changed (e.g., 'thuc_linh')")
    change: float = Field(..., description="Absolute change amount")
    percentage: float = Field(..., description="Percentage change")
    direction: str = Field(..., description="'increase' or 'decrease'")
```

**8. SalaryTrend**
```python
class SalaryTrend(BaseModel):
    average_income: float = Field(..., description="Average monthly income")
    average_deductions: float = Field(..., description="Average monthly deductions")
    average_net: float = Field(..., description="Average monthly net salary")
    highest_month: Optional[MonthlySalary] = None
    lowest_month: Optional[MonthlySalary] = None
    significant_changes: List[SalaryChange] = Field(default_factory=list)
```

**9. SalaryHistoryResponse**
```python
class SalaryHistoryResponse(BaseModel):
    employee_id: str
    employee_name: Optional[str] = None
    period: SalaryPeriod = Field(..., description="Query period (year, from_month-to_month)")
    months: List[MonthlySalary] = Field(default_factory=list)
    trend: Optional[SalaryTrend] = None
```

### Field Mapping Reference

Document in comments which HRS API field index maps to each schema field:

```python
# HRS API Field Mapping (fields[index])
#
# Summary:
# - fields[32]: tong_tien_cong (Total income)
# - fields[43]: thuc_linh (Net salary)
# - Sum of deductions: tong_tien_tru (calculated)
#
# Income (32 fields):
# - fields[44]: luong_co_ban
# - fields[2]: thuong_nang_suat
# - fields[3]: phu_cap_chuc_vu
# ... (add complete mapping)
#
# Deductions (10 fields):
# - fields[33]: bhxh
# - fields[34]: bhtn (unemployment)
# - fields[35]: bhyt
# ... (add complete mapping)
```

### Best Practices

1. **Default Values:** Use 0.0 for optional numeric fields (easier than Optional[float])
2. **Descriptions:** Add Vietnamese + English descriptions for clarity
3. **Validation:** Use Pydantic validators if needed (e.g., month range 1-12)
4. **Example Values:** Add Config class with example JSON for OpenAPI docs

```python
class SalaryResponse(BaseModel):
    # ... fields ...

    class Config:
        json_schema_extra = {
            "example": {
                "employee_id": "VNW0006204",
                "employee_name": "PHAN ANH TUẤN",
                "period": {"year": 2024, "month": 12},
                "summary": {
                    "tong_tien_cong": 15000000,
                    "tong_tien_tru": 3331510,
                    "thuc_linh": 11668490
                },
                "income": {"luong_co_ban": 7205600, ...},
                "deductions": {"bhxh": 1080840, ...}
            }
        }
```

## Dependencies

- [ ] Pydantic library (already installed)
- [ ] Reference HRS API field mapping from user's provided code
- [ ] No external dependencies

## Effort Estimate

- **Size:** S (Small)
- **Hours:** 2-3 hours
  - 1h: Define 9 schemas with fields
  - 0.5h: Add field descriptions and validators
  - 0.5h: Document field mapping in comments
  - 0.5h: Add example values for OpenAPI docs
  - 0.5h: Testing/validation
- **Parallel:** false (no dependencies, but first task in sequence)

## Definition of Done

- [ ] All 9 schemas created in `backend/app/schemas/hrs_data.py`
- [ ] All schemas use proper types (float, int, str, Optional)
- [ ] Field descriptions added with Field() for documentation
- [ ] Field mapping documented in code comments
- [ ] Example values added for OpenAPI docs (Config class)
- [ ] File imports correctly (no syntax errors)
- [ ] Code follows existing schema patterns from `backend/app/schemas/employees.py`
- [ ] Ready for use in service layer (Task 002)

## Related Files

**Create:**
- `backend/app/schemas/hrs_data.py`

**Reference (for pattern consistency):**
- `backend/app/schemas/employees.py` (follow existing patterns)

**Documentation:**
- User's provided HRS client code (lines 150-208 for field mapping)
