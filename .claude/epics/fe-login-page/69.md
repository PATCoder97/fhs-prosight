---
name: Create OAuth Callback Handler Page
status: open
created: 2026-01-12T12:02:50Z
updated: 2026-01-12T12:11:36Z
github: https://github.com/PATCoder97/fhs-prosight/issues/69
depends_on: [66]
parallel: true
conflicts_with: []
---

# Task: Create OAuth Callback Handler Page

## Description

Tạo page mới `auth-callback.vue` để xử lý OAuth redirect callback từ backend. Page này sẽ parse token từ URL, validate format, lưu vào localStorage, và redirect user đến dashboard hoặc hiển thị error nếu có vấn đề.

## Acceptance Criteria

- [x] File `frontend/src/pages/auth-callback.vue` được tạo
- [x] Parse token từ URL query parameters (`?token=...`)
- [x] Parse token từ URL fragment (`#token=...`) nếu query không có
- [x] Validate token format: phải có 3 parts separated by dots (JWT format)
- [x] Lưu token vào localStorage với key `auth_token` nếu valid
- [x] Redirect đến dashboard (`/dashboard` hoặc `/`) sau khi save token
- [x] Handle error cases:
  - URL có `?error=...` → redirect về login với error message
  - Token không tồn tại → redirect về login với error "no_token"
  - Token invalid format → redirect về login với error "invalid_token"
- [x] Hiển thị loading indicator trong khi processing
- [x] Layout: blank (không có sidebar/navbar)

## Technical Details

**File to create:**
- `frontend/src/pages/auth-callback.vue`

**Implementation:**
```vue
<script setup>
import { onMounted } from 'vue'
import { useRouter } from 'vue-router'

definePage({
  meta: {
    layout: 'blank',
    public: true,
  },
})

const router = useRouter()

onMounted(() => {
  // Parse token from URL (query or fragment)
  const urlParams = new URLSearchParams(window.location.search)
  const hashParams = new URLSearchParams(window.location.hash.substring(1))

  const token = urlParams.get('token') || hashParams.get('token')
  const error = urlParams.get('error')

  if (error) {
    // Handle error: redirect to login with error message
    router.push({ path: '/login', query: { error } })
    return
  }

  if (token) {
    // Validate JWT format (basic check: must have 3 parts)
    const parts = token.split('.')
    if (parts.length === 3) {
      // Valid JWT format
      localStorage.setItem('auth_token', token)

      // Redirect to dashboard or home
      router.push('/')
    } else {
      // Invalid token format
      router.push({ path: '/login', query: { error: 'invalid_token' } })
    }
  } else {
    // No token found
    router.push({ path: '/login', query: { error: 'no_token' } })
  }
})
</script>

<template>
  <div class="d-flex align-center justify-center" style="min-height: 100vh;">
    <div class="d-flex flex-column align-center gap-4">
      <VProgressCircular
        indeterminate
        color="primary"
        size="64"
      />
      <span class="text-h6">Đang xử lý đăng nhập...</span>
    </div>
  </div>
</template>
```

**Key logic:**
1. `onMounted` - Chạy ngay khi component mounted
2. Parse URL params (support cả query và fragment)
3. Check error first
4. Validate token (basic JWT check: 3 parts)
5. Save to localStorage
6. Redirect based on result

**Token validation:**
- JWT format: `header.payload.signature`
- Basic check: `token.split('.').length === 3`
- Không cần decode/verify signature (backend đã làm)

**Redirect paths:**
- Success: `/` or `/dashboard`
- Error: `/login?error={error_code}`

## Dependencies

- [x] Task 66: Environment Configuration (không direct dependency nhưng cùng system)
- [x] Vue Router (already configured)
- [x] Vuetify components (VProgressCircular)

## Effort Estimate

- Size: M
- Hours: 3 hours
- Parallel: true (có thể làm song song với Task 67, 68)

## Definition of Done

- [x] File `auth-callback.vue` created
- [x] Token parsing logic implemented
- [x] JWT validation implemented
- [x] localStorage save implemented
- [x] Redirect logic for success case
- [x] Redirect logic for all error cases
- [x] Loading indicator displays
- [x] Tested with mock URL: `/auth/callback?token=header.payload.signature`
- [x] Tested with error URL: `/auth/callback?error=access_denied`
- [x] Tested invalid token format
- [x] No ESLint errors
- [x] No console errors
